<!doctype html>
<html>

<head>
  <title>Simple Chat</title>
</head>

<body>
  <h1>WebSocket Chat</h1>
  <textarea id="messages" readonly rows="10" cols="50"></textarea><br />
  <input id="messageInput" type="text" placeholder="Type a message..." />
  <button id="sendButton">Send</button>
  <button id="resetButton">Reset</button>
  <button id="disconnectButton">Disconnect</button>
  <button id="debugButton">Toggle Debug</button>

  <script>
    let socket;
    let debugMode = false; // Debug mode flag

    function connectWebSocket() {
      socket = new WebSocket("ws://localhost:8080/ws");

      socket.onmessage = function (event) {
        logDebug(`üì© Message received: ${event.data}`);
        const messages = document.getElementById("messages");
        messages.value += `\n${event.data}`;
        messages.scrollTop = messages.scrollHeight;
      };

      socket.onopen = function () {
        logDebug("‚úÖ WebSocket connected");
      };

      socket.onerror = function (error) {
        logDebug(`‚ùå WebSocket Error: ${error.message}`);
      };

      socket.onclose = function () {
        logDebug("‚ö†Ô∏è WebSocket connection closed. Reconnecting...");
        setTimeout(connectWebSocket, 3000);
      };
    }

    connectWebSocket();

    document.getElementById("sendButton").onclick = function () {
      sendMessage();
    };

    document
      .getElementById("messageInput")
      .addEventListener("keypress", function (event) {
        if (event.key === "Enter") {
          sendMessage();
        }
      });

    document.getElementById("resetButton").onclick = function () {
      document.getElementById("messages").value = "";
      document.getElementById("messageInput").value = "";
      logDebug("üîÑ Chat reset.");
    };

    document.getElementById("disconnectButton").onclick = function () {
      if (socket) {
        socket.close();
        logDebug("üîå WebSocket manually disconnected.");
      }
    };

    document.getElementById("debugButton").onclick = function () {
      debugMode = !debugMode;
      alert(`Debug Mode: ${debugMode ? "ON" : "OFF"}`);
    };

    function sendMessage() {
      const messageInput = document.getElementById("messageInput");
      const message = messageInput.value.trim();

      if (message) {
        socket.send(message);
        logDebug(`üì§ Sent message: ${message}`);
        messageInput.value = "";
      }
    }

    function logDebug(message) {
      if (debugMode) {
        console.log(message);
      }
    }
  </script>
</body>

</html>
